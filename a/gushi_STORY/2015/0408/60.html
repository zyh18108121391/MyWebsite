<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />

<title>小房子-郑银华的专属网站_【学习笔记】leancloud中 javascript遇到的问题和解决方案</title>
<meta name="keywords" content="学习,笔记,leancloud,javascript" />
<meta name="description" content="有幸我接触到了javascript的一个很好用的框架leancloud，它提供了为Android、javascript、ios/os提供了很方便的数据操作，以及服务器支持。 我学习的javascript，并且容易的加入了我自己的网站中www.zhengyinhua.com，其中留言板就是使用的这个平台，操作简单" />

<link href="/templets/default/style.css" rel="stylesheet" type="text/css" />
<link href="/templets/default/photostyle.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/templets/default/pic.js"></script>
<script type="text/javascript" src="/templets/default/runphoto.js"></script>
<script type="text/javascript">

function mover_HOME(){
	document.getElementById("HOME").style.marginTop="15px";	
}
function mout_HOME(){
	document.getElementById("HOME").style.marginTop="0px";
}

function mover_STORY(){
	document.getElementById("STORY").style.marginTop="15px";	
}
function mout_STORY(){
	document.getElementById("STORY").style.marginTop="0px";
}

function mover_PHOTO(){
	document.getElementById("PHOTO").style.marginTop="15px";	
}
function mout_PHOTO(){
	document.getElementById("PHOTO").style.marginTop="0px";
}

function mover_VIDEO(){
	document.getElementById("VIDEO").style.marginTop="15px";	
}
function mout_VIDEO(){
	document.getElementById("VIDEO").style.marginTop="0px";
}

function mover_ABOUT(){
	document.getElementById("ABOUT").style.marginTop="15px";	
}
function mout_ABOUT(){
	document.getElementById("ABOUT").style.marginTop="0px";
}
</script>

</head>

<body>
<div class="bd">

<link rel="shortcut icon" href="favicon.ico" />
<!--头部开始-->
<div id="head">
	<!--悬浮模块-->	
	<div id="float_dh">
		<div id="Photos_dh">
		<a href="/a/3Dxiangce/" title="进入3D相册">3D相册</a>
		</div>
		
		<div id="Messages_dh">
		<a href="/a/liuyanqiang/" title="进入留言墙">留言墙</a>
		</div>
	</div>
	<div id="float_fx">
		<script type="text/javascript" src="/templets/default/js/qqfx.js"></script>
		<script src="http://qzonestyle.gtimg.cn/qzone/app/qzlike/qzopensl.js#jsdate=20111201" charset="utf-8"></script>
	</div>
	<!--悬浮模块结束-->	
	
		<div id="left"><a class="log" href="/"></a></div>
		<div  id="log_words">小房子-这里属于郑银华的另一片内心世界！</div>
		<div id="dh_list">
		<ul>
			<li id="HOME" onmouseover="mover_HOME()" onmouseout="mout_HOME()" class="button dh"><a href="/"><div class="li-a1">主页</div><div class="li-a2">HOME</div></a></li>			
			<li id="STORY" onmouseover="mover_STORY()" onmouseout="mout_STORY()"  class="button dh"><a href="/a/gushi_STORY/"><div class="li-a1">故事</div><div class="li-a2">STORY</div></a></li>
			<li id="PHOTO" onmouseover="mover_PHOTO()" onmouseout="mout_PHOTO()" class="button dh"><a href="/a/xiangce_PHOTO/"><div class="li-a1">相册</div><div class="li-a2">PHOTO </div></a></li>
			<li id="VIDEO" onmouseover="mover_VIDEO()" onmouseout="mout_VIDEO()" class="button dh"><a href="/a/shipin_VIDEO/"><div class="li-a1">视频</div><div class="li-a2">VIDEO</div></a></li>
			<li id="ABOUT" onmouseover="mover_ABOUT()" onmouseout="mout_ABOUT()" class="button dh"><a href="/a/guanyu_ABOUT/"><div class="li-a1">关于</div><div class="li-a2">ABOUT</div></a></li>
		</ul>
		</div>
  </div>
  <div id="hr"></div>
  <!--头部结束-->

  <div id="content">
  	<div id="article_content">
	
		<div id="article_left">
			<div id="NewStory">
				<div id="header">
				<span id="head_left">最新动态-NEW STORY</span>
				</div>
				<div id="article_news">
					<ul>
						<li><a href="/a/xiangce_PHOTO/2015/0602/67.html" title="最爱LOL德莱文金牌主播">最爱LOL德莱文金牌主播...</a></li>
<li><a href="/a/gushi_STORY/2015/0602/66.html" title="【游戏人生】第一次玩LOL居然是">【游戏人生】第一次玩LOL居然是...</a></li>
<li><a href="/a/gushi_STORY/2015/0602/65.html" title="【技术心得】域名及网站如何进行">【技术心得】域名及网站如何进行...</a></li>
<li><a href="/a/gushi_STORY/2015/0503/64.html" title="【学习心得】英语四级学习计划 ">【学习心得】英语四级学习计划 ...</a></li>
<li><a href="/a/gushi_STORY/2015/0427/63.html" title="【网站优化】seo必不可少之锚文">【网站优化】seo必不可少之锚文...</a></li>

					</ul>
				</div>
			</div>
			<div id="RecommendImg">
				<div id="header">
				<span id="head_left">推荐图文-RECOMMENT PHOTO </span>
				<span id="head_right"><a href="/a/xiangce_PHOTO/">MORE+</a></span>
				</div>
				<div id="article_imgs">
					<ul>
						<li><a href="/a/xiangce_PHOTO/2015/0602/67.html" title="最爱LOL德莱文金牌主播"><img src='/uploads/allimg/150602/1-150602162SDJ.png' border='0' width='120' height='120' alt='最爱LOL德莱文金牌主播'></a></li>
<li><a href="/a/xiangce_PHOTO/2015/0302/51.html" title="七中合照-海内存知己天涯若比邻"><img src='/uploads/allimg/150302/1-1503021H126.jpg' border='0' width='120' height='120' alt='七中合照-海内存知己天涯若比邻'></a></li>
<li><a href="/a/xiangce_PHOTO/2015/0302/50.html" title="儿时回忆-转盘画糖你可吃过"><img src='/uploads/allimg/150302/1-1503021G005.jpg' border='0' width='120' height='120' alt='儿时回忆-转盘画糖你可吃过'></a></li>
<li><a href="/a/xiangce_PHOTO/2015/0201/39.html" title="最佳缘分-三人同年同月同日生"><img src='/uploads/allimg/150201/1-150201201000-lp.jpg' border='0' width='120' height='120' alt='最佳缘分-三人同年同月同日生'></a></li>

					</ul>
				</div>
			</div>
		</div><!--article_left end-->
		
		<div id="article_right">
			<div id="header">
				<span id="head_left">>>当前位置:<a href='http://localhost//'></a> > <a href='/a/gushi_STORY/'>故事-STORY</a> > </span>
			</div>
			<div id="article_abody">
			<div id="article_title">【学习笔记】leancloud中 javascript遇到的问题和解决方案</div>
			<div id="article_timeandmore">点击数：<strong style="color:#CCCCCC"><script src="/plus/count.php?view=yes&aid=60&mid=1" type='text/javascript' language="javascript"></script></strong>次 更新时间：<strong style="color:#CCCCCC">2015-04-08 22:45</strong></div>
			<div id="article_bodyContent">
			有幸我接触到了javascript的一个很好用的框架leancloud，它提供了为Android、javascript、ios/os提供了很方便的数据操作，以及服务器支持。<br />
&nbsp;<br />
我学习的javascript，并且容易的加入了我自己的网站中www.zhengyinhua.com，其中留言板就是使用的这个平台，操作简单，把网站上获取的数据上传到leancloud平台保存。不管是保存数据还是读取数据都只需要几行代码就行。<br />
&nbsp;<br />
另外还做了一个公司的产品查询的小项目，由于数据庞大，自然操作起来就复杂得多，需要的查询样式也多种多样，在其中就遇到了许多问题，困扰了好久。下面说说问题，再把解决的方法记录下来。<br />
&nbsp;<br />
<strong>一：查询（query）超过1000条限制怎么办？</strong><br />
<br />
在leancloud的javascri文档中就有这样一句话:&rdquo;对于超过1000个对象的类来说,count操作会被时间限制所约束.它们可能会一直&nbsp;返回超时错误,或者只是返回一个近似正确的值.这样的话你应该更合理地规划你&nbsp;程序的结构来避免这种情况.&rdquo;<br />
<br />
所以在进行查询的时候超过1000条数据时&nbsp;需要用到query.skip(number)，并且使用递归重复调用知道查询结束。具体代码如下：<br />
<br />
&nbsp; &nbsp; var&nbsp;skipNum=1;//记录跳跃的次数
<div>
	&nbsp; &nbsp; SumPros(query);//函数开始<br />
	&nbsp; &nbsp; function&nbsp;SumPros(query){<br />
	&nbsp; &nbsp; query.find({<br />
	&nbsp; &nbsp; &nbsp; &nbsp;success:&nbsp;function(results)&nbsp;{ &nbsp; &nbsp;<br />
	&nbsp; &nbsp; &nbsp; &nbsp;sum=sum+results.length;<br />
	&nbsp; &nbsp; &nbsp; &nbsp;if(results.length==1000){<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;query.skip(1000*skipNum);<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;skipNum=skipNum+1;<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SumPros(query);//递归调用自己<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else{<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//这里写全部读取到数据后的动作<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
	&nbsp; &nbsp; &nbsp; &nbsp;},<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;error:&nbsp;function(error)&nbsp;{<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alert(&quot;查询出错&quot;);<br />
	&nbsp; &nbsp; &nbsp; &nbsp; }<br />
	&nbsp; &nbsp; &nbsp;});<br />
	&nbsp; &nbsp;}</div>
每次跳跃1000&nbsp;然后从1000过后开始重新查找，1000可以改成1-10000之间的数字，递归直到最后一次跳过后数量没饱和换句话说就是&nbsp;小于1000（自己设置的跳跃数）。这样就能保证全部吧表格的数据取出来了。<br />
&nbsp;<br />
<strong>二：query查询异步问题，千万别把它放在一个循环体里面循环执行。</strong><br />
&nbsp;<br />
在编写查询产品销量或者产量的是&nbsp;需要循环2个表格一个是ProductCategory&nbsp;一个是Product,本想在2个循环体中完成业务逻辑。谁知道query.find或者query.count函数总是等循环体中其他元素执行完毕过后才执行，比如说索引i，索引就是整个循环体的灵魂，结果它比其中的元素还跑在前面，那还玩个dan。所以解决方案就是，调整思路先执行一个循环，然后在它成功过后再执行其他循环，先后顺序很重要。别放在for语句里面，你会哭的。<br />
&nbsp;<br />
<strong>三：query.find()中寻找条件为指针的时候。</strong><br />
<br />
query.find()中&nbsp;获取某一属性为特定值的时候（获取某一行数据该数据满足某一条件），当改条件的值并不是string或者number等常见的类型而是pointer（指针），在匹配参数中必须填写一个object类才能找到。如下代码：<br />
<br />
var&nbsp;post&nbsp;=&nbsp;new&nbsp;Post();post.id&nbsp;=&nbsp;&quot;520c7e1ae4b0a3ac9ebe326a&quot;;query.equalTo(&quot;post&quot;,&nbsp;post);<br />
<br />
object.get(&#39;category&#39;)&nbsp;获取到的就是一个object类。用.id即可获得id。<br />
<br />
<strong>获取更多技术心得文章：&nbsp;&nbsp;</strong>&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp;<a href="http://www.zhengyinhua.com/a/gushi_STORY/2015/0316/57.html">【技术心得】郑银华教你最简单的重装系统的方法，任何都能装系统</a><br />
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp;<a href="http://www.zhengyinhua.com/a/gushi_STORY/2015/0318/58.html">【技术心得】笔记本设置WiFi热点（我讲究的是技术）</a><br />
&nbsp;&nbsp;&nbsp;<br />
小房子-<a href="http://www.zhengyinhua.com/">郑银华</a>的专属网站、一个温馨的世界，一颗温暖的内心。<br />
&nbsp;<br />

			</div>
			<div class="context">
				<ul>
					<li>上一篇：<a href='/a/gushi_STORY/2015/0319/59.html'>【技术心得】传统的装Windows系统方法并不依赖软件（新手慎入）</a> </li>
					<li>下一篇：<a href='/a/gushi_STORY/2015/0417/61.html'>【网站优化】优化网站几点基本准则 不管百度算法如何改变</a> </li>
				</ul>
			</div><!-- /context -->
			</div>
	
		</div><!--article_right end-->
	</div>
	
  </div><!--content end-->
  <div class="clear"></div>
<!---尾部开始---->
	<div id="hr2"></div>
	<div id="footer">
	<div class="center">
	<div id="footer_img"><a href="/" title="小房子-郑银华的专属网站"><img src="/templets/default/images/logfooter.png" /></a></div>
		<div id="footer_copy">
		<div class="footer_word">小房子</div>
			<ul>
				<li>联系电话：18108121391</li>
				<li><span class="qqtalk">QQ交谈:</span><span class="qqtalkimg"><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=390579684&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:390579684:51" alt="点击这里给我QQ交谈" title="点击这里给我QQ交谈"/></a></span></li>
				<div class="clear"></div>
				<li><a href="/a/liuyanqiang/">给我留言<img src="/templets/default/images/messages.png"  width="20px" height="20px"/></a></li>
				<li>@2014-2015 版权所有</li>
			</ul>
		</div>
		<div id="footer_dh">
		<div class="footer_word">相关链接</div>
			<ul>
				<li><a href="/a/gushi_STORY/">故事-STORY</a></li>
				<li><a href="/a/xiangce_PHOTO/">相册-PHOTO</a></li>
				<li><a href="/a/shipin_VIDEO/">视频-VIDEO</a></li>
				<li><a href="/a/guanyu_ABOUT/">关于-ABOUT</a></li>
			</ul>
		</div>
		</div>
	</div>
<!--尾部结束-->
	
  </div>
</body>
</html>
